<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary mb-4">
  <%= image_tag("shards-logo.svg", :alt => "Example Navbar 1", :class => "mr-2", :height => "30")%>
  <a class="navbar-brand" href="#">小聚</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown-1"
    aria-controls="navbarNavDropdown-1" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavDropdown-1">
    <ul class="navbar-nav mr-auto">
    </ul>

    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link " href="/login">
          登录
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/signup">
          注册
        </a>
      </li>
    </ul>
  </div>
</nav>



<div class="container">
  <div class="row text-center">
    <div class="col-2"></div>
    <div class="col-8">
      <div class="card" style="margin-top: 200px;">
      <h4 style="margin-top: 20px;">加入小聚</h4>
      <%= form_with(model: @user, local: true) do |form| %> <% if @user.errors.any? %>
      <div id="error_explanation">
        <ul>
          <% @user.errors.full_messages.each do |message| %>
          <div class="alert alert-danger" role="alert">
            <%= message %>
          </div>
          <% end %>
        </ul>
      </div>
      <% end %>
        <div class="row mb-2">
          
            <div class="col-12">
              
                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>

                    
                      <%= form.text_field :email, class: "form-control", id: "form-email", placeholder: "电子邮箱"%>
                      
                      
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>
                      
                      <%= form.text_field :name, class: "form-control", id: "form-name", placeholder: "用户名"%>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>
                      
                      <%= form.text_field :password, class: "form-control", id: "form-password", placeholder: "密码" %>
                    </div>
                  </div>
                </div>


                

                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>
                      <%= form.text_field :password_confirmation, class: "form-control", id: "form-password-confirmation", placeholder: "确认密码"%>
                    </div>
                  </div>
                </div>


                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>
                      <%= form.text_field :nickname, class: "form-control", id: "form-nickname", placeholder: "昵称"%>
                    </div>
                  </div>
                </div>


                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>
                      <input name="user[birthday]" id="form-birthday" class="form-control" placeholder="生日" data-provide="datepicker">
                      
                      
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>
                      <%= form.text_field :tel, class: "form-control", id: "form-tel", placeholder: "联系电话" %>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                
                      <div class="custom-file">
                        <input type="file" class="custom-file-input">
                        <label class="custom-file-label">选择头像文件</label>
                        
                      </div>
                      <button id="submit-button22" class="btn btn-primary" type="button">上传头像</button>
                      

                      <div>
                        <img src="" class="img" style="width: 100px;">
                      </div>
                    </div>
                  </div>
                </div>


                <div class="row">
                  <div class="form-group col-md-2"></div>
                  <div class="form-group col-md-8">
                    <div class="input-group input-group-seamless">
                      <span class="input-group-prepend">
                        <span class="input-group-text">
                          <i class="fa fa-user" style="color:#abb6bf;"></i>
                        </span>
                      </span>
                      
                      <%=form.text_field :photo_url, disabled: "disabled", class: "form-control", id: "form-file-url"%>
                      
                    </div>
                  </div>
                </div>
                
                


                

                <div class="actions">
                    
                    <%= form.submit "注册", class:"btn btn-primary", id:"sub12"%>
                </div>
              <% end %>
              
            </div>

          </div>
          
     </div>
    
  </div>
</div>


<script>


$('#submit-button22').click(function(){
      var files = $('#form-file').prop('files');
      var data = new FormData();
      console.log(files);
      data.append('smfile', files[0]);
      $('#sub12').addClass('disabled');
      $.ajax({
        url : 'https://sm.ms/api/upload',
        type : 'POST',
        data : data,
        cache : false,
        processData : false,
        contentType : false,
        async: false,//异步
        success: function(json) {
            
            console.log();
            $('#sub12').removeClass('disabled');
            json = JSON.parse(json);
            console.log(json);
            if(json.image !== null) {
                console.log(json.images);
                $('#form-file-url').val(json.images);
                $(".img").attr("src", json.images);
            }
            else if (json.success === true) {
            
                console.log(json.data.url);
                $('#form-file-url').val(json.data.url);
                $(".img").attr("src", json.data.url);
            }

            
        }
      });
    });
</script>